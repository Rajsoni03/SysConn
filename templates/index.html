<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Config Setup</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 2em;
            background: #000;
            color: #fff;
        }

        .container {
            max-width: 500px;
            margin: auto;
        }

        .form-group {
            margin-bottom: 1em;
        }

        label {
            display: block;
            margin-bottom: 0.5em;
        }

        input {
            width: 100%;
            padding: 0.5em;
            background: #222;
            color: #fff;
            border: 1px solid #444;
        }

        button {
            padding: 0.5em 1em;
            background: #444;
            color: #fff;
            border: none;
            cursor: pointer;
        }

        .success {
            color: green;
        }

        .error {
            color: red;
        }

        .message {
            margin-top: 1em;
        }

        .documentation {
            margin-top: 2em;
        }

        li {
            margin-bottom: 0.3em;
            font-size: 0.9em;
            color: #ccc;
            font-family:'Courier New', Courier, monospace;
        }

        a {
            color: #1E90FF;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>

<body>
    <div class="container">
        <h2>System Flask Configuration (v{{ data.VERSION }})</h2>
        <form id="configForm" action="/set_config" method="post">
            <div class="form-group">
                <label for="auth_token">Auth Token</label>
                <input type="text" id="auth_token" name="AUTH_TOKEN" value="{{ data.AUTH_TOKEN }}" required>
            </div>
            <div class="form-group">
                <label for="sudo_password">Sudo Password</label>
                <input type="text" id="sudo_password" name="SUDO_PASSWORD" value="{{ data.SUDO_PASSWORD }}" required>
            </div>
            <button type="submit">Save Config</button>
        </form>
        <div id="message" class="message"></div>
        
        <p class="documentation">
            Ô∏èüìÑ <strong>Documentation & Important Notes:</strong>
            <ul>
                <li>This tool requires an AUTH_TOKEN and SUDO_PASSWORD to operate securely.</li>
                <li>Login to <a href="https://raj.dhcp.ti.com/token" target="_blank">MyZone</a> and generate an AUTH_TOKEN from there.</li>
                <li>Set a SUDO_PASSWORD of your Linux machine.</li>
                <li>Ensure that the AUTH_TOKEN and SUDO_PASSWORD are not empty or set to "null" / "None".</li>
                <li>For security reasons, if the AUTH_TOKEN is set, only requests from localhost are allowed for configuration changes.</li>
                <li>If you need to reset the configuration, you can manually edit the config.json file in the config directory.</li>
                <li>Make sure to keep your AUTH_TOKEN and SUDO_PASSWORD secure and do not share them.</li>
            </ul>
            
        </p>
        <script>
            document.getElementById('configForm').addEventListener('submit', function (e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                fetch(form.action, {
                    method: 'POST',
                    body: formData
                })
                    .then(async response => {
                        const data = await response.json();
                        if (response.ok && data.status === "success") {
                            document.getElementById('message').innerHTML = `<div class='success'>${data.message}</div>`;
                        } else {
                            document.getElementById('message').innerHTML = `<div class='error'>${data.message || 'Error updating config'}</div>`;
                        }
                    })
                    .catch(error => {
                        document.getElementById('message').innerHTML = '<div class="error">Network error</div>';
                    });
            });
        </script>
    </div>
</body>

</html>